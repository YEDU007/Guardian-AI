<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Guardian AI | Settings</title>
  <link rel="stylesheet" href="assets/styles.css">
</head>
<body>

<!-- Navbar -->
<div id="navbar-container"></div>
<script>
  fetch("components/navbar.html")
    .then(r => r.text())
    .then(html => {
      document.getElementById("navbar-container").innerHTML = html;
    });
</script>

<div class="card">
  <h2>âš™ï¸ System Settings</h2>

  <label>
    <input type="checkbox" id="alertSound">
    Enable Alert Sound
  </label>

  <br><br>

  <label>Alert Sensitivity</label>
  <select id="sensitivity">
    <option value="low">Low</option>
    <option value="medium">Medium</option>
    <option value="high">High</option>
  </select>

  <br><br>

  <label>Cooldown (minutes)</label>
  <input type="number" id="cooldown">

  <button type="button" onclick="saveSettings()">ğŸ’¾ Save Settings</button>

  <hr>

  <h3>âœ… Saved Settings</h3>
  <div id="settingsPreview"></div>
</div>

<script type="module">
  import { auth, db } from "./firebase/firebase-config.js";
  import { onAuthStateChanged, signOut }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-auth.js";
  import { doc, getDoc, setDoc }
    from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

  let uid;

  onAuthStateChanged(auth, async user => {
    if (!user) return location.href = "index.html";
    uid = user.uid;

    const snap = await getDoc(doc(db, "settings", uid));
    if (snap.exists()) showPreview(snap.data());
  });

  function showPreview(d) {
    settingsPreview.innerHTML = `
      <div class="alert-card">
        ğŸ”” Sound: ${d.alertSound ? "On" : "Off"}<br>
        ğŸ¯ Sensitivity: ${d.alertSensitivity}<br>
        â± Cooldown: ${d.cooldownTime} min
      </div>
    `;
  }

  window.saveSettings = async () => {
    try {
      const data = {
        alertSound: alertSound.checked,
        alertSensitivity: sensitivity.value,
        cooldownTime: cooldown.value
      };

      await setDoc(doc(db, "settings", uid), data);
      showPreview(data);
      alert("Settings saved");

    } catch (err) {
      alert("Save failed: " + err.message);
    }
  };

  window.logout = () =>
    signOut(auth).then(() => location.href = "index.html");
</script>

</body>
</html>
